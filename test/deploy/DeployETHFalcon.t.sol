// SPDX-License-Identifier: MIT
pragma solidity ^0.8.25;

import {Script} from "../../lib/forge-std/src/Script.sol";
import "../../src/ZKNOX_ethfalcon.sol";
import "../../src/ZKNOX_falcon_deploy.sol";

import {console, Test} from "forge-std/Test.sol";

//deploy the precomputed tables for psirev and psiInvrev
contract Script_Deploy_psirev is Test {
    // SPDX-License-Identifier: MIT

    function test_run() external {
        bytes32 salty = keccak256(abi.encodePacked("ZKNOX_v0.14"));

        ZKNOX_ethfalcon ETHFALCON = new ZKNOX_ethfalcon{salt: salty}();

        // public key in ntt form
        // forgefmt: disable-next-line
        uint256[32] memory tmp_pkc = [5662797900309780854973796610500849947334657117880689816302353465126500706865, 19773102689601973621062070293263100534733440101750387150077711329493973274058, 14606681890476865709816748627007131256488820167404174518724605890405097603719, 15845234755931409677594030697035096324340457247480758851130851814703350289524, 5524941775098342886171484209767745714294893760953145782448900256027476885810, 15301033023652038200658165594502048003364566882283859976805808429697192567788, 18875246040654000517074755552890901133645669291006567534900678519700207707731, 11843395683334522200668269515783436692309636627649985746204914551011013629864, 8419305811746464065544475584323153271481428319969733938911379662274846467111, 18343417927809591481517183183479503623951147924071925629514120039495430967592, 10007451325105194000131443764495043320645967197761209321537835667210153693191, 779487061150515667795843171268512499191273448454307717194241961063365614179, 14889466660684110621550004892629051623956217990147793956971155241422811501259, 2995124819739638247263964985959552967489690950312509006670204449438399867779, 16698797261630410217796026169071784061995015858612862963622742163763641855864, 13129716852402613948762495927854872029721399215764359316540986925328111906305, 8620514528683669238836845045565231437047299941974001946945409334379184590766, 5184181041252042291984928267300200431567362250531180743278111084485128161037, 15555356690664302555826193017277818624355238475260445618945780405430020481200, 19264077329172342356817033544893125657281034846341493111114385757819435942150, 8708853592016768361541207473719404660232059936330605270802350059910738161396, 21018648773068189736719755689803981281912117625241701774409626083005150670687, 267026197077955750670312407002345619518873569178283514941902712705828521229, 14359242962640593260752841229079220345384234239741953227891227234975247894859, 8320354099602406351863744856415421903486499003224102136141447162113864442068, 17564344674783852357247325589247473882830766139750808683064015010041459773180, 12601232530472338126510941067000966999586933909071534455578397454667291628041, 17820703520112071877812607241017358905719406745793395857586668204300579510382, 20977963461796112341763752649093803701879441191599296283127418471622134932903, 5627732773047409045458881938100601008133088383905060686572856121439798106767, 2602661464000108367786729796742170641292899005030508211661215565063118195399, 20110282897068872581106488251090599973196923955248066799683528955504800771309];

        // signature s2
        // forgefmt: disable-next-line
        uint256[32] memory tmp_s2 = [35340882464924523541995235154197297331698212535822337674871285992432664907, 180224035295898734967424559955110864706259919802156795967147536627173294392, 21660108970659236332012478115952358326918007598343581207077716353317091147806, 21426877096970411006463900407158094543758079600974377313834920144686872068138, 21532573972444033887945810679016838468960936465445605310938766495257100824575, 21554088683744040996748006764668557361486174635377514903964211445294077313280, 21573529119057153769253416776347610441096552414441883024503392124998338150498, 53006652221508247962266517649092413191335746399468556370572797863029899311, 21294041067427257618839626452643844082030500202723276839266466992478450089999, 21696887185757653556905065230288601351252470876317472519462491639050772164277, 7393549702196722486937355513781543883815551295472474195991424503815024614, 295392398154090825770484205193313540394559827038657366580035133567333838807, 190821289315785238182371032232920054077122865834943957235452129484914688036, 21511363660720150848316943631887470437079875802390899065969407652249137262529, 21605010302597845556479029048990850163848484454155759471590000898968861945844, 90109987156902090936530777855008758360371939969806389104874041211754721020, 104572084346066340167083551182104689146293539485848256090626339792851304472, 514156647755522783060040765974913519453868610190488203601010740475827650740, 197889410495044568095010513345112256806038811134476442977434269697754214349, 21318778198406262401873362605515470069085124541617237697498893509567816138811, 83047527626503079969967455649559960577956137462230952838902833155772198860, 21627976888044018637707984826286220060254605975249490293366060763764927246205, 325103499572572032874165825271180576496456259468362034620514497536126955455, 21259033927213570867800144627469482151777426893391078165896623693625123078265, 21274936629179632135911704720746147246288012508036889754345464058860469759919, 125451587548471666038100046017214664884947170069029004350974217027543314385, 21506065442957682415953035674987275763404500059127299000966211256928596930438, 21221922783649838897706181833337517808517798162318114440910270965561724186444, 164643698358110908220571711946393125783699674605573664832288166753027633019, 21395077839965026954895174082835214542011281553796169586746661093872653578018, 424045155797942844106670610447724202898460225829873252761779863646138859786, 21347374393184156463198939959870175941440385865926587820609152397676420083656];

        uint256[] memory s2 = new uint256[](32);
        uint256[] memory pkc = new uint256[](32);
        for (uint256 i = 0; i < 32; i++) {
            s2[i] = tmp_s2[i];
            pkc[i] = tmp_pkc[i];
        }

        bytes memory message =
            "\x4d\x79\x20\x6e\x61\x6d\x65\x20\x69\x73\x20\x52\x65\x6e\x61\x75\x64\x20\x66\x72\x6f\x6d\x20\x5a\x4b\x4e\x4f\x58\x21\x21\x21\x21";
        bytes memory salt =
            "\x46\xb9\xdd\x2b\x0b\xa8\x8d\x13\x23\x3b\x3f\xeb\x74\x3e\xeb\x24\x3f\xcd\x52\xea\x62\xb8\x1b\x82\xb5\x0c\x27\x64\x6e\xd5\x76\x2f\xd7\x5d\xc4\xdd\xd8\xc0\xf2\x00";

        bool result = ETHFALCON.verify(message, salt, s2, pkc);
        assertEq(result, true);
    }
}
