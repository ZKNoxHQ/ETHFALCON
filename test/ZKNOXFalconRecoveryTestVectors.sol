// code generated using pythonref/generate_falcon_recovery_test_vectors.py.
pragma solidity ^0.8.25;

import {Test, console} from "forge-std/Test.sol";
import "../src/ZKNOX_NTT.sol";
import "../src/ZKNOX_falconrec.sol";

contract ZKNOX_FalconRecTest is Test {
    ZKNOX_falconrec falconrec;
    //exemple of stateless initialisation, no external contract provided
    ZKNOX_NTT ntt = new ZKNOX_NTT(address(0), address(0), 12289, 12265);
    // same for HashToPoint
    ZKNOX_HashToPoint h2p = new ZKNOX_HashToPoint();
    // forgefmt: disable-next-line
    uint256[1024] psi_rev = [uint256(1), 1479, 4043, 7143, 5736, 4134, 1305, 722, 1646, 1212, 6429, 9094, 3504, 8747, 9744, 8668, 4591, 6561, 5023, 6461, 10938, 4978, 6512, 8961, 11340, 9664, 9650, 4821, 563, 9314, 2744, 3006, 1000, 4320, 12208, 3091, 9326, 4896, 2366, 9238, 11563, 7678, 1853, 140, 1635, 9521, 11112, 4255, 7203, 10963, 9088, 9275, 790, 955, 11119, 2319, 9542, 4846, 3135, 3712, 9995, 11227, 3553, 7484, 544, 5791, 11950, 2468, 11267, 9, 9447, 11809, 10616, 8011, 7300, 6958, 1381, 2525, 4177, 8705, 2837, 5374, 4354, 130, 2396, 4452, 3296, 8340, 12171, 9813, 2197, 5067, 11336, 3748, 5767, 827, 3284, 2881, 5092, 10200, 10276, 9000, 9048, 11560, 10593, 10861, 334, 2426, 4632, 5755, 11029, 4388, 10530, 3707, 3694, 7110, 11934, 3382, 2548, 8058, 4890, 6378, 9558, 3932, 5542, 12144, 3459, 3637, 1663, 1777, 1426, 7635, 2704, 5291, 7351, 8653, 9140, 160, 12286, 7852, 2166, 8374, 7370, 12176, 3364, 10600, 9018, 4057, 2174, 7917, 2847, 7875, 7094, 9509, 10805, 4895, 2305, 5042, 4053, 9644, 3985, 7384, 476, 3531, 420, 6730, 2178, 1544, 9273, 243, 9289, 11618, 3136, 5191, 8889, 9890, 9103, 6882, 10163, 1630, 11136, 2884, 8241, 10040, 3247, 9603, 2969, 3978, 6957, 3510, 9919, 9424, 7575, 8146, 1537, 12047, 8585, 2678, 5019, 545, 7404, 1017, 10657, 7205, 10849, 8526, 3066, 12262, 11244, 2859, 2481, 7277, 2912, 5698, 354, 7428, 390, 11516, 3778, 8456, 442, 2401, 5101, 11222, 4976, 10682, 875, 3780, 7278, 11287, 5088, 4284, 6022, 9302, 2437, 3646, 10102, 9723, 6039, 9867, 11854, 7952, 10911, 1912, 11796, 8193, 9908, 5444, 9041, 1207, 5277, 1168, 11885, 4645, 1065, 2143, 3957, 2839, 10162, 151, 11858, 1579, 2505, 5906, 52, 3174, 1323, 2766, 3336, 6055, 6415, 677, 3445, 7509, 4698, 5057, 12097, 10968, 10240, 4912, 5241, 9369, 3127, 4169, 3482, 787, 6821, 11279, 12231, 241, 11286, 3532, 11404, 6008, 10333, 7280, 2844, 3438, 8077, 975, 5681, 8812, 142, 1105, 4080, 421, 3602, 6221, 4624, 6212, 3263, 8689, 5886, 4782, 5594, 3029, 4213, 504, 605, 9987, 2033, 8291, 10367, 8410, 11316, 11035, 10930, 5435, 3710, 6196, 6950, 5446, 8301, 468, 11973, 11907, 6152, 4948, 11889, 10561, 6153, 6427, 3643, 5415, 56, 9090, 5206, 6760, 1702, 10302, 11635, 3565, 5315, 8214, 7373, 4324, 10120, 11767, 5079, 3262, 11011, 2344, 6715, 1973, 5925, 1018, 3514, 11248, 7500, 7822, 5537, 4749, 8500, 12142, 5456, 7840, 6844, 8429, 7753, 1050, 6118, 3818, 9606, 1190, 5876, 2281, 2031, 5333, 8298, 8320, 12133, 2767, 453, 6381, 418, 3772, 5429, 4774, 1293, 7552, 2361, 1843, 9259, 4115, 218, 2908, 8855, 8760, 2882, 10484, 1954, 2051, 2447, 6147, 576, 3963, 1858, 7535, 3315, 11863, 2925, 347, 3757, 1975, 10596, 3009, 174, 11566, 9551, 5868, 2655, 6554, 1512, 11939, 5383, 10474, 9087, 7796, 6920, 10232, 6374, 1483, 49, 11026, 1489, 2500, 10706, 5942, 1404, 11964, 11143, 948, 4049, 3728, 1159, 5990, 652, 5766, 6190, 11994, 4016, 4077, 2919, 3762, 6328, 7183, 10695, 1962, 7991, 8960, 12121, 9597, 7105, 1200, 6122, 9734, 3956, 1360, 6119, 5297, 3054, 6803, 9166, 1747, 5919, 4433, 3834, 5257, 683, 2459, 8633, 12225, 9786, 9341, 6507, 1566, 11454, 6224, 3570, 8049, 3150, 1319, 4046, 11580, 1958, 7967, 2078, 1112, 11231, 8210, 11367, 441, 1826, 9363, 9118, 4489, 3708, 3238, 11153, 3449, 7080, 1092, 3359, 3205, 8024, 8611, 10361, 11825, 2068, 10900, 4404, 346, 3163, 8257, 7449, 6127, 12164, 11749, 10763, 4222, 8051, 11677, 8921, 8062, 7228, 11071, 11851, 3515, 9011, 5993, 6877, 8080, 1536, 10568, 4103, 9860, 11572, 8700, 1373, 2982, 3448, 11946, 4538, 1908, 4727, 11081, 1866, 7078, 10179, 716, 10125, 6873, 1705, 2450, 11475, 416, 10224, 5826, 7725, 8794, 1756, 4145, 8755, 8328, 5063, 4176, 8524, 10771, 2461, 2275, 8022, 5653, 6693, 6302, 11710, 3889, 212, 6323, 9175, 2769, 5734, 1176, 5508, 11014, 4860, 11164, 11158, 10844, 11841, 1014, 7508, 7365, 10962, 3607, 5232, 8347, 12221, 10029, 7723, 5836, 3200, 1535, 9572, 60, 7784, 10032, 10872, 5676, 3087, 6454, 7406, 3975, 7326, 8545, 2528, 3056, 5845, 5588, 11877, 5102, 1255, 506, 10897, 5784, 9615, 2212, 3338, 9013, 1178, 9513, 6811, 8778, 10347, 3408, 1165, 2575, 10453, 425, 11897, 10104, 377, 4578, 375, 1620, 1038, 11366, 6085, 4167, 6092, 2231, 2800, 12096, 1522, 2151, 8946, 8170, 5002, 12269, 7681, 5163, 10545, 1314, 2894, 3654, 11951, 3947, 9834, 6599, 7350, 7174, 1248, 2442, 8330, 6492, 6330, 10141, 5724, 10964, 1945, 1029, 8945, 6691, 10397, 3624, 6825, 4906, 4670, 512, 7735, 11295, 9389, 12050, 1804, 1403, 6195, 7100, 406, 10602, 7021, 12143, 8914, 9998, 7954, 3393, 8464, 8054, 7376, 8761, 11667, 1737, 4499, 5672, 8307, 9342, 11653, 5609, 4605, 2689, 180, 8151, 5219, 1409, 204, 6780, 9806, 2054, 1344, 9247, 463, 8882, 3981, 1468, 4475, 7043, 3017, 1236, 9168, 4705, 2600, 11232, 4739, 4251, 1226, 6771, 11925, 2360, 3028, 5216, 11839, 10345, 11711, 5368, 11779, 7628, 2622, 6903, 8929, 7605, 7154, 12226, 8481, 8619, 2373, 7302, 10891, 9199, 826, 5043, 5789, 8787, 6671, 10631, 9224, 1506, 7806, 5703, 4719, 11538, 6389, 11379, 4693, 9951, 11872, 9996, 6138, 8820, 4443, 8871, 7186, 10398, 1802, 10734, 1590, 4411, 1223, 2334, 2946, 6828, 2637, 4510, 881, 365, 10362, 1015, 7250, 6742, 2485, 904, 24, 10918, 11009, 11675, 980, 11607, 5082, 7699, 5207, 8239, 844, 7087, 3221, 8016, 8452, 2595, 5289, 6627, 567, 2941, 1406, 2633, 6940, 2945, 3232, 11996, 3769, 7434, 3944, 8190, 6759, 5604, 11024, 9282, 10118, 8809, 9169, 6184, 6643, 6086, 8753, 5370, 8348, 8536, 1282, 3572, 9457, 2021, 4730, 3229, 1706, 3929, 5054, 3154, 9004, 7929, 12282, 1936, 8566, 11444, 11520, 5526, 50, 216, 767, 3805, 4153, 10076, 1279, 11424, 9617, 5170, 12100, 3116, 10080, 1763, 3815, 1734, 1350, 5832, 8420, 4423, 1530, 1694, 10036, 10421, 9559, 5411, 4820, 1160, 9195, 7771, 2840, 9811, 4194, 9270, 7315, 4565, 7211, 10506, 944, 7519, 7002, 8620, 7624, 6883, 3020, 5673, 5410, 1251, 10499, 7014, 2035, 11249, 6164, 10407, 8176, 12217, 10447, 3840, 2712, 4834, 2828, 4352, 1241, 4378, 3451, 4094, 3045, 5781, 9646, 11194, 7592, 8711, 8823, 10588, 7785, 11511, 2626, 530, 10808, 9332, 9349, 2046, 8972, 9757, 8957, 12150, 3268, 3795, 1849, 6513, 4523, 4301, 457, 8, 8835, 3758, 8071, 4390, 10013, 982, 2593, 879, 9687, 10388, 11787, 7171, 6063, 8496, 8443, 1573, 5969, 4649, 9360, 6026, 1030, 11823, 10608, 8468, 11415, 9988, 5650, 12119, 648, 12139, 2307, 8000, 11498, 9855, 9416, 2827, 9754, 11169, 21, 6481];

    // forgefmt: disable-next-line
    uint256[1024] psi_inv_rev = [uint256(1), 10810, 5146, 8246, 11567, 10984, 8155, 6553, 3621, 2545, 3542, 8785, 3195, 5860, 11077, 10643, 9283, 9545, 2975, 11726, 7468, 2639, 2625, 949, 3328, 5777, 7311, 1351, 5828, 7266, 5728, 7698, 4805, 8736, 1062, 2294, 8577, 9154, 7443, 2747, 9970, 1170, 11334, 11499, 3014, 3201, 1326, 5086, 8034, 1177, 2768, 10654, 12149, 10436, 4611, 726, 3051, 9923, 7393, 2963, 9198, 81, 7969, 11289, 8652, 8830, 145, 6747, 8357, 2731, 5911, 7399, 4231, 9741, 8907, 355, 5179, 8595, 8582, 1759, 7901, 1260, 6534, 7657, 9863, 11955, 1428, 1696, 729, 3241, 3289, 2013, 2089, 7197, 9408, 9005, 11462, 6522, 8541, 953, 7222, 10092, 2476, 118, 3949, 8993, 7837, 9893, 12159, 7935, 6915, 9452, 3584, 8112, 9764, 10908, 5331, 4989, 4278, 1673, 480, 2842, 12280, 1022, 9821, 339, 6498, 11745, 10146, 11224, 7644, 404, 11121, 7012, 11082, 3248, 6845, 2381, 4096, 493, 10377, 1378, 4337, 435, 2422, 6250, 2566, 2187, 8643, 9852, 2987, 6267, 8005, 7201, 1002, 5011, 8509, 11414, 1607, 7313, 1067, 7188, 9888, 11847, 3833, 8511, 773, 11899, 4861, 11935, 6591, 9377, 5012, 9808, 9430, 1045, 27, 9223, 3763, 1440, 5084, 1632, 11272, 4885, 11744, 7270, 9611, 3704, 242, 10752, 4143, 4714, 2865, 2370, 8779, 5332, 8311, 9320, 2686, 9042, 2249, 4048, 9405, 1153, 10659, 2126, 5407, 3186, 2399, 3400, 7098, 9153, 671, 3000, 12046, 3016, 10745, 10111, 5559, 11869, 8758, 11813, 4905, 8304, 2645, 8236, 7247, 9984, 7394, 1484, 2780, 5195, 4414, 9442, 4372, 10115, 8232, 3271, 1689, 8925, 113, 4919, 3915, 10123, 4437, 3, 12129, 3149, 3636, 4938, 6998, 9585, 4654, 10863, 10512, 10626, 11848, 922, 4079, 1058, 11177, 10211, 4322, 10331, 709, 8243, 10970, 9139, 4240, 8719, 6065, 835, 10723, 5782, 2948, 2503, 64, 3656, 9830, 11606, 7032, 8455, 7856, 6370, 10542, 3123, 5486, 9235, 6992, 6170, 10929, 8333, 2555, 6167, 11089, 5184, 2692, 168, 3329, 4298, 10327, 1594, 5106, 5961, 8527, 9370, 8212, 8273, 295, 6099, 6523, 11637, 6299, 11130, 8561, 8240, 11341, 1146, 325, 10885, 6347, 1583, 9789, 10800, 1263, 12240, 10806, 5915, 2057, 5369, 4493, 3202, 1815, 6906, 350, 10777, 5735, 9634, 6421, 2738, 723, 12115, 9280, 1693, 10314, 8532, 11942, 9364, 426, 8974, 4754, 10431, 8326, 11713, 6142, 9842, 10238, 10335, 1805, 9407, 3529, 3434, 9381, 12071, 8174, 3030, 10446, 9928, 4737, 10996, 7515, 6860, 8517, 11871, 5908, 11836, 9522, 156, 3969, 3991, 6956, 10258, 10008, 6413, 11099, 2683, 8471, 6171, 11239, 4536, 3860, 5445, 4449, 6833, 147, 3789, 7540, 6752, 4467, 4789, 1041, 8775, 11271, 6364, 10316, 5574, 9945, 1278, 9027, 7210, 522, 2169, 7965, 4916, 4075, 6974, 8724, 654, 1987, 10587, 5529, 7083, 3199, 12233, 6874, 8646, 5862, 6136, 1728, 400, 7341, 6137, 382, 316, 11821, 3988, 6843, 5339, 6093, 8579, 6854, 1359, 1254, 973, 3879, 1922, 3998, 10256, 2302, 11684, 11785, 8076, 9260, 6695, 7507, 6403, 3600, 9026, 6077, 7665, 6068, 8687, 11868, 8209, 11184, 12147, 3477, 6608, 11314, 4212, 8851, 9445, 5009, 1956, 6281, 885, 8757, 1003, 12048, 58, 1010, 5468, 11502, 8807, 8120, 9162, 2920, 7048, 7377, 2049, 1321, 192, 7232, 7591, 4780, 8844, 11612, 5874, 6234, 8953, 9523, 10966, 9115, 12237, 6383, 9784, 10710, 431, 12138, 2127, 9450, 8332, 5808, 12268, 1120, 2535, 9462, 2873, 2434, 791, 4289, 9982, 150, 11641, 170, 6639, 2301, 874, 3821, 1681, 466, 11259, 6263, 2929, 7640, 6320, 10716, 3846, 3793, 6226, 5118, 502, 1901, 2602, 11410, 9696, 11307, 2276, 7899, 4218, 8531, 3454, 12281, 11832, 7988, 7766, 5776, 10440, 8494, 9021, 139, 3332, 2532, 3317, 10243, 2940, 2957, 1481, 11759, 9663, 778, 4504, 1701, 3466, 3578, 4697, 1095, 2643, 6508, 9244, 8195, 8838, 7911, 11048, 7937, 9461, 7455, 9577, 8449, 1842, 72, 4113, 1882, 6125, 1040, 10254, 5275, 1790, 11038, 6879, 6616, 9269, 5406, 4665, 3669, 5287, 4770, 11345, 1783, 5078, 7724, 4974, 3019, 8095, 2478, 9449, 4518, 3094, 11129, 7469, 6878, 2730, 1868, 2253, 10595, 10759, 7866, 3869, 6457, 10939, 10555, 8474, 10526, 2209, 9173, 189, 7119, 2672, 865, 11010, 2213, 8136, 8484, 11522, 12073, 12239, 6763, 769, 845, 3723, 10353, 7, 4360, 3285, 9135, 7235, 8360, 10583, 9060, 7559, 10268, 2832, 8717, 11007, 3753, 3941, 6919, 3536, 6203, 5646, 6105, 3120, 3480, 2171, 3007, 1265, 6685, 5530, 4099, 8345, 4855, 8520, 293, 9057, 9344, 5349, 9656, 10883, 9348, 11722, 5662, 7000, 9694, 3837, 4273, 9068, 5202, 11445, 4050, 7082, 4590, 7207, 682, 11309, 614, 1280, 1371, 12265, 11385, 9804, 5547, 5039, 11274, 1927, 11924, 11408, 7779, 9652, 5461, 9343, 9955, 11066, 7878, 10699, 1555, 10487, 1891, 5103, 3418, 7846, 3469, 6151, 2293, 417, 2338, 7596, 910, 5900, 751, 7570, 6586, 4483, 10783, 3065, 1658, 5618, 3502, 6500, 7246, 11463, 3090, 1398, 4987, 9916, 3670, 3808, 63, 5135, 4684, 3360, 5386, 9667, 4661, 510, 6921, 578, 1944, 450, 7073, 9261, 9929, 364, 5518, 11063, 8038, 7550, 1057, 9689, 7584, 3121, 11053, 9272, 5246, 7814, 10821, 8308, 3407, 11826, 3042, 10945, 10235, 2483, 5509, 12085, 10880, 7070, 4138, 12109, 9600, 7684, 6680, 636, 2947, 3982, 6617, 7790, 10552, 622, 3528, 4913, 4235, 3825, 8896, 4335, 2291, 3375, 146, 5268, 1687, 11883, 5189, 6094, 10886, 10485, 239, 2900, 994, 4554, 11777, 7619, 7383, 5464, 8665, 1892, 5598, 3344, 11260, 10344, 1325, 6565, 2148, 5959, 5797, 3959, 9847, 11041, 5115, 4939, 5690, 2455, 8342, 338, 8635, 9395, 10975, 1744, 7126, 4608, 20, 7287, 4119, 3343, 10138, 10767, 193, 9489, 10058, 6197, 8122, 6204, 923, 11251, 10669, 11914, 7711, 11912, 2185, 392, 11864, 1836, 9714, 11124, 8881, 1942, 3511, 5478, 2776, 11111, 3276, 8951, 10077, 2674, 6505, 1392, 11783, 11034, 7187, 412, 6701, 6444, 9233, 9761, 3744, 4963, 8314, 4883, 5835, 9202, 6613, 1417, 2257, 4505, 12229, 2717, 10754, 9089, 6453, 4566, 2260, 68, 3942, 7057, 8682, 1327, 4924, 4781, 11275, 448, 1445, 1131, 1125, 7429, 1275, 6781, 11113, 6555, 9520, 3114, 5966, 12077, 8400, 579, 5987, 5596, 6636, 4267, 10014, 9828, 1518, 3765, 8113, 7226, 3961, 3534, 8144, 10533, 3495, 4564, 6463, 2065, 11873, 814, 9839, 10584, 5416, 2164, 11573, 2110, 5211, 10423, 1208, 7562, 10381, 7751, 343, 8841, 9307, 10916, 3589, 717, 2429, 8186, 1721, 10753, 4209, 5412, 6296, 3278, 8774, 438, 1218, 5061, 4227, 3368, 612, 4238, 8067, 1526, 540, 125, 6162, 4840, 4032, 9126, 11943, 7885, 1389, 10221, 464, 1928, 3678, 4265, 9084, 8930, 11197, 5209, 8840, 1136, 9051, 8581, 7800, 3171, 2926, 10463];

    //stateful initialisation
    function setUp() public {
        bytes memory bytecode_psirev = abi.encodePacked(psi_rev);

        address a_psirev; //address of the precomputations bytecode contract
        a_psirev = address(uint160(0xcaca)); //here it is etched, use create in the future
        vm.etch(a_psirev, bytecode_psirev); //pushing psirev bytecode into contract todo : replace with create

        bytes memory bytecode_psiInvrev = abi.encodePacked(psi_inv_rev);

        address a_psiInvrev; //address of the precomputations bytecode contract
        a_psiInvrev = address(uint160(0xa5a5)); //here it is etched, use create in the future
        vm.etch(a_psiInvrev, bytecode_psiInvrev); //pushing psirev bytecode into contract todo : replace with create

        ntt.update(a_psirev, a_psiInvrev, 12289, 12265); //update ntt with outer contract

        falconrec = new ZKNOX_falconrec(ntt, h2p);
    }

    function testVector0() public {
        // public key
        // forgefmt: disable-next-line
        address pk_0 = address(589959844205978517058917870757624514131424632278);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(239), 12113,207,73,252,14,94,152,52,5,12262,12288,12100,34,12118,11992,145,162,164,12118,12057,12276,63,113,192,42,12265,12089,269,12154,60,161,74,12278,12233,227,12264,22,146,12167,171,12083,12155,116,12003,12168,61,12233,62,91,12264,12254,82,319,67,207,227,33,12281,11721,12200,12179,103,12124,107,240,12227,12262,245,12249,12143,12169,166,38,63,12240,171,12136,12172,20,12028,11909,64,171,12277,20,23,12180,12235,80,136,12117,13,12242,216,255,353,94,12233,12238,249,188,304,190,12288,12024,12255,80,169,77,12,12127,29,39,24,12237,130,12163,36,12250,12089,18,12034,12101,35,12119,12281,81,12127,18,12222,93,12263,12270,12193,11971,12209,12274,48,46,23,12195,305,12138,12009,11927,128,155,12280,12273,262,12283,88,40,233,12093,12284,12011,12285,12200,12263,256,11736,12283,12152,12212,12240,12137,12234,51,287,150,12272,162,12156,73,12119,12178,12233,117,43,12139,12091,6,12175,89,54,370,12269,72,276,171,12102,208,146,12198,234,12169,29,12178,185,12269,12179,12257,12231,243,295,12175,232,12033,12133,12271,356,12114,39,30,12016,12056,229,12156,186,280,41,12152,12206,12024,38,57,29,11966,12178,156,12063,12091,12041,125,12269,12190,187,185,149,24,12286,12073,12192,53,72,88,1,12239,245,334,12091,192,12204,12219,12236,37,12102,225,117,16,12208,12281,12221,12263,11985,12241,12233,161,12163,12264,12222,12212,12146,12128,9,12237,79,105,12007,59,12280,12092,12097,126,79,12132,12006,12171,12276,12131,40,12013,12214,12155,12240,12249,146,128,12228,12241,12092,284,180,12229,11881,85,111,109,103,71,12124,18,12085,97,137,12106,12236,12139,12137,11972,12209,12215,12061,12165,11972,51,354,12217,12199,19,12134,11962,12133,12065,12207,12274,12165,11948,11855,17,12114,12279,12091,12212,53,129,111,460,236,12196,12117,12103,117,70,11979,314,91,27,12051,216,10,184,71,12154,39,12212,0,12108,43,115,12206,55,134,47,12213,158,12245,12252,12255,12137,11956,12086,12067,12282,12190,200,12142,114,12159,12180,47,12192,184,295,34,93,11780,12178,12102,12211,103,63,12065,87,141,12125,12268,12024,142,12,13,128,154,26,7,136,16,69,176,12073,12069,184,138,50,87,31,12107,12200,12171,368,12260,12280,12005,28,194,54,191,12219,149,12130,68,199,5,55,42,176,11906,12246,158,384,19,12103,12270,132,143,12268,12259,431,12165,12098,12138,12085,11990,35,58,84,195,12248,12105,63,10,178,12271,68,11918,12116,12223,286,12128,83,12175,12239,12220,1,126,12120,12016,68,12074,76,106,12128,97,3,11831,231,12241,12069,225,166,244,255,323,16,11997,12045,12086,12107,25,11868];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(12265), 248,252,84,12279,89,12164,12207,12222,12092,97,12256,12108,94,12282,12269,12107,114,12199,12249,12201,12234,12238,12115,110,12261,177,67,12083,67,2,12245,356,12131,311,12267,12076,12165,12212,12242,12213,361,14,50,2,29,12249,12228,12254,190,12142,12064,12217,213,421,11957,11932,121,12277,12105,268,12226,197,153,12076,180,188,12109,11,39,21,317,12226,68,0,12250,194,12256,12267,12252,12235,12248,12260,236,14,424,12176,12096,69,47,12072,12061,233,19,214,12277,12273,12136,60,12136,12180,12282,12251,12270,12043,12185,145,104,134,12205,159,14,129,79,1,12164,12129,88,12252,12177,58,138,12214,207,166,11867,12004,87,12018,138,162,12065,12178,12111,12280,12240,68,12236,251,43,117,21,379,12215,12220,12162,270,97,312,12165,244,204,12281,200,123,12141,12080,12108,212,69,12068,12235,191,115,92,296,353,11999,12075,12210,12192,11998,12063,12157,4,78,12198,124,271,12143,12287,15,39,1,12102,11829,49,12158,11991,12163,12152,95,12057,12288,12246,12128,283,111,12279,11767,12281,68,12280,12196,137,12055,11974,255,154,12204,12156,12031,103,38,104,12255,12080,64,33,109,12249,82,12144,104,67,12257,12110,546,12208,292,37,156,12287,56,11990,16,18,148,12161,1,372,12226,12103,12106,12249,13,83,12176,12234,12262,12236,12123,183,144,256,12089,12110,77,372,187,4,12106,12147,1,293,12137,22,12041,12149,12196,2,73,12209,229,48,67,35,40,12150,128,12226,53,12040,91,205,12200,23,12076,12087,168,12226,244,187,12268,125,12235,157,58,256,12079,347,11822,12165,52,12199,191,12159,100,12284,12098,12160,12278,12219,187,211,68,12282,106,303,159,182,12192,13,202,12177,12167,172,50,12277,142,75,12034,12182,12169,12065,12184,12157,12223,118,12283,22,90,207,12104,94,64,12236,12171,12110,12102,12105,12164,12181,12211,12001,49,12276,12091,12222,267,81,434,12273,12265,12281,12232,12226,12040,110,306,52,277,70,12132,11,104,34,12026,12127,12208,11896,130,19,31,131,12182,154,136,36,118,12187,11962,344,13,12248,8,11,12190,12218,35,12171,16,12241,12164,186,129,12002,283,117,12242,128,143,12197,12145,49,12043,66,12106,136,78,12288,6,22,204,12288,57,12194,11996,235,29,274,168,12267,334,53,54,106,11905,12207,12033,66,12182,388,168,124,100,207,228,65,12249,12037,137,100,12142,12239,17,156,236,0,32,12016,12106,0,165,12072,11885,146,125,12024,175,181,12219,12284,12069,12261,12185,93,12164,34,12247,128,12287,12160,7,262,174,254,12131,12108,101,228,76,12093,12088,149,12268,12287,12148,12166,12288,12127,12224,18,12273,12282,0,12190,134,12102,12222,46,12039];

        ZKNOX_falconrec.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(4961), 601,6260,9133,7870,6664,11300,8850,6628,8445,607,2764,7957,4250,10012,4921,11872,11400,10968,10452,115,8712,12094,1893,12264,2542,11081,484,10530,10752,10089,7862,9011,7155,9187,7717,993,11324,10481,4949,6191,10487,9303,6731,9216,4492,3659,2599,5540,6374,3075,7203,697,11606,10391,6497,10541,1902,1443,4079,4340,10429,6619,1654,6137,4972,7184,5138,1569,3885,1859,6684,293,3039,3212,8750,2370,10658,10732,2196,9011,3476,9518,6936,457,11559,1329,7516,4494,11833,9407,7972,11159,1515,1475,1071,7932,12257,10005,5165,11143,10341,5734,8255,11401,10793,10328,10835,8014,11203,11797,3161,3546,9110,805,7059,6695,5875,10675,11461,1952,11171,11422,5454,3363,9980,7750,8947,5987,2699,11185,388,4160,1594,9396,4481,12073,897,4600,4300,5557,9405,719,5065,2197,2207,5858,10987,8435,10626,2383,2851,9241,4938,11281,9754,3903,9325,3002,5681,2687,2337,2107,2209,5117,4872,8978,10341,9415,11048,10461,9359,3514,3437,10356,2715,8694,12095,1188,10796,6339,4732,1306,2919,7670,11988,5492,6220,3983,11727,421,2805,8047,2801,2162,4140,1056,705,5472,3092,6945,8657,6393,1753,6434,6607,187,156,1529,1078,1373,4186,2344,3269,12206,1922,5698,4884,8508,10378,2762,1811,1707,2005,7898,162,7529,10066,1012,1598,6767,8122,10558,5683,4106,4860,10278,9563,5746,9657,4254,4105,11440,2266,7323,1487,2096,12213,7154,4938,1068,10754,7620,12224,7328,9127,2367,4553,3599,11572,7070,9638,6342,11154,506,2460,1148,1337,2609,6851,11916,10371,6693,5753,12285,6003,3208,1672,1497,247,6197,5406,663,355,4853,6461,7021,7320,729,9323,8650,8998,4068,2999,9016,2369,2043,114,2338,2465,11685,6347,9181,4147,6722,9612,8502,2575,8402,845,9847,1715,10917,2477,9415,3737,2782,175,2180,3662,586,8597,10618,8922,3902,6319,6005,7406,3578,3388,11458,6465,5407,6734,157,10808,4157,10120,991,4997,7880,5771,5078,3975,2821,6254,3600,12277,6507,6092,9021,4281,1157,4170,7944,263,456,11192,1482,12222,6855,3104,7167,5150,1098,6521,6308,7926,10525,3284,1151,4765,4443,4706,6477,97,3724,11313,9101,12111,4006,4162,3626,10078,8550,11200,3153,6030,1666,9479,1990,9151,6135,348,3945,7198,9946,10069,9410,3353,1386,11567,5494,10491,7242,50,7593,12109,6901,3262,4466,10321,10618,3878,11008,2444,4136,5076,4490,9447,2380,1599,11584,5353,3633,4547,3707,1746,217,11437,11514,8345,7549,7264,5025,10406,1162,11743,10741,8916,9717,4374,7774,11747,10619,5326,8820,5734,11116,10832,3080,7211,8973,7607,183,8609,2283,10619,8983,10782,8665,11436,12271,10301,8955,1554,7625,2409,5800,7293,11547,3910,2630,10133,9923,3971,12138,841,1970,11953,8152,12262,11702,7110,893,9076,4818,7638,3117,7717,10781,6882,1285,9093,3318,7036,9601,9758,11283,5972,2526,49,4288,5178,5685,12172,11776,3355,10704,9373,10436,9721];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.ntt_sm2[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "My name is Renaud";
        sig.salt =
            "\x16\x1a\x97\xe0\xf4\xc6\x89\x2a\xea\x94\x2a\x85\xf1\x01\xad\x3a\x6b\x54\xe0\x5c\xa4\x30\xfa\x33\x8c\x46\xd5\xc4\x50\x04\xa5\x7b\x73\x4f\x55\x14\x41\x5c\x71\x93";
        address recovered_pk_0;
        recovered_pk_0 = falconrec.recover(message, sig);
        assertEq(pk_0, recovered_pk_0);
    }

    function testVector1() public {
        // public key
        // forgefmt: disable-next-line
        address pk_1 = address(589959844205978517058917870757624514131424632278);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(117), 12044,60,39,12205,11809,12189,14,115,195,103,50,316,12135,12138,280,42,52,52,0,12244,12134,12117,12158,220,12132,12052,68,12218,12060,49,11981,12275,12088,50,12243,96,123,239,12256,101,108,8,12137,78,12274,10,12085,277,64,12145,12028,15,12194,55,12205,118,12261,19,12210,231,12137,28,118,3,21,12003,12192,12267,197,300,231,116,12231,12287,12187,12234,390,12101,147,165,278,12249,12211,12234,51,84,275,11961,124,12143,17,94,261,12127,206,12254,2,11914,74,12235,154,12271,124,28,15,143,35,10,12218,12105,11990,11942,104,49,41,12126,12120,278,12204,12263,42,12242,18,121,12251,12270,234,12265,12060,51,11890,229,263,12116,33,12282,12192,27,12191,64,71,113,12177,98,12277,19,12161,12285,11901,144,12226,165,12041,12113,201,12215,12059,12133,12249,12247,46,12160,12155,120,12227,12103,11979,57,12179,12201,274,12226,12225,12284,12214,147,12240,1,103,12171,90,12270,414,55,12202,12230,282,12249,12187,12251,12037,45,12100,131,11907,154,66,12019,12106,12260,11999,12070,12273,59,12239,12236,11990,125,34,12134,12283,5,12252,12004,12227,12213,12143,12138,12006,12094,149,12277,214,12277,12088,2,12261,12024,12190,12201,11905,12227,12286,12163,12058,12032,12107,42,282,12170,21,251,12011,12241,53,12133,12155,585,80,101,102,58,12231,149,12257,41,180,12178,12229,12223,192,12191,12206,53,12235,12115,141,103,257,84,12073,11948,67,7,12108,12249,49,11980,12202,1,37,67,117,161,12177,79,236,12024,31,68,146,76,11975,11996,12191,11880,12115,146,112,12202,57,12111,112,12024,12083,12145,12192,78,12222,12190,12209,11889,12212,12038,12279,11948,109,12200,25,12246,11823,59,20,134,11858,134,11954,12085,12221,105,194,83,12270,11969,250,12230,12274,229,104,8,12165,12261,12179,12071,16,264,335,12270,12174,12200,197,129,246,12236,71,12156,11926,78,3,12252,11991,12099,98,12245,11974,12281,134,12169,12106,9,24,136,17,18,12220,12238,12271,12056,12196,322,12222,12141,97,12279,12250,89,91,182,12237,12101,137,7,106,12159,12135,19,12153,11989,12171,12118,149,241,235,12246,12217,266,12219,72,12123,200,107,12171,12120,12214,12263,12049,12195,12266,12043,7,165,12173,86,12208,12174,20,368,77,77,12231,12204,12205,338,11989,12280,11942,11978,61,96,12208,12274,12045,12187,8,12273,100,79,4,366,345,199,12008,12096,137,347,264,25,63,155,164,77,12284,123,12247,12239,12061,12179,12167,31,12049,11913,217,306,109,12204,11923,208,12287,74,12087,152,220,12161,12241,12270,12149,12244,17,222,12242,12084,12,12164,127,120,12237,316,12121,187,11953,12195,143,78,12199,33,12210,12237,134,468,12158,153];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(48), 125,359,12279,12225,66,12159,12284,11924,12059,12105,201,12136,12257,12198,12138,12162,12115,194,12272,207,12228,82,59,40,12232,12162,208,12220,198,12161,211,12088,76,10,28,280,118,12229,11814,12017,41,12098,11957,204,106,12167,12224,83,12242,12144,12204,12234,68,48,3,215,17,12239,12194,5,39,12075,12124,12139,62,12194,98,228,114,19,10,112,12128,102,12245,292,12184,12127,12165,14,335,160,203,12201,12233,89,47,12136,51,157,71,75,105,11860,12139,12109,12132,111,155,12250,12201,15,119,12168,12069,140,12199,12080,12218,179,14,28,62,11918,11923,122,12241,24,206,12175,11,228,12114,12264,12062,114,213,57,465,12150,12177,12038,87,117,10,25,103,12151,168,171,93,4,152,12262,12282,103,12125,78,12228,175,12167,12288,424,0,133,12123,189,12130,12022,145,12272,12227,12228,12205,73,188,12128,12002,12016,11987,12282,12168,12269,92,305,12231,12200,100,12143,46,160,12018,26,12008,11927,76,1,12150,12219,12073,127,306,222,12209,268,12279,12251,12246,165,75,299,112,12275,12,11998,12160,250,20,114,12138,1,26,178,147,54,12052,183,262,12199,12219,12176,331,142,262,69,12167,272,43,12206,90,174,12214,85,12269,197,140,12211,269,279,12120,24,12264,36,11843,12185,12203,187,238,12205,12267,107,12076,75,68,58,82,12226,12260,252,12198,12113,12066,12229,40,46,57,12234,281,126,98,61,11988,19,12260,12273,187,230,96,12064,12180,12213,104,5,12191,12051,182,12082,332,78,12089,39,12171,12202,12167,12242,201,13,12193,93,12160,12074,82,91,12218,12252,110,145,12195,12140,334,128,157,158,12231,12117,11886,66,77,12135,12190,58,77,12196,11972,91,12215,12221,84,12223,12006,224,303,12169,210,104,124,12159,12128,31,12287,264,191,12152,261,12223,12229,12280,19,92,5,12054,12034,12167,53,171,12253,12115,12280,125,12266,231,17,11974,212,159,193,12240,12221,87,26,60,77,12195,132,22,12174,171,12218,79,179,114,73,12160,12110,44,12279,121,12214,343,286,143,12081,140,12175,12207,201,12222,12171,12270,140,103,12250,81,45,12266,261,277,170,12276,12059,12285,83,12209,12177,12245,144,170,98,12106,12197,12261,349,139,12215,192,12126,58,12009,11925,11898,67,12053,117,12241,83,265,307,12162,134,12080,11984,12261,141,48,12246,107,33,12123,12229,78,340,122,12058,12176,141,120,12170,12157,12202,200,12117,12001,104,101,198,28,170,13,12165,12176,173,4,42,96,12283,217,12199,12272,12276,12224,12098,12106,12220,216,12249,49,46,35,12084,12252,19,12188,111,12217,12151,12060,139,88,366,12033,112,3,12237,12167,12265,12212,14,2,12286,21,12];

        ZKNOX_falconrec.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(6026), 11713,5013,7637,4928,7730,2273,147,2352,11770,11811,11492,11253,5423,7687,4232,9412,5210,7102,8512,8051,8537,5010,9211,11807,11557,10122,6124,811,7333,5199,5569,5820,2356,1847,2359,5991,9288,6120,5828,11582,4288,5165,10377,6844,1535,5350,520,1633,749,9907,640,171,10797,7968,448,5628,8969,2060,3205,11701,3818,2374,137,6812,5405,5860,366,11873,1482,8882,3959,11760,3781,8686,11809,2463,1458,938,6226,8879,2785,5684,3683,12188,10285,277,9350,5574,3688,9473,2377,10528,1705,10436,9696,9432,3068,3490,8251,1818,148,10370,3434,5164,11330,11554,11329,2240,9754,7541,1368,6471,11042,7023,11596,4259,8488,9332,878,11048,4278,12089,11326,2612,3091,7322,6369,8500,9093,825,7206,3957,7428,223,1736,9309,7861,6305,2766,12166,4632,10134,188,6658,2508,8799,3581,1763,960,632,4137,5281,6874,2381,3352,4097,3676,5978,10529,9677,6344,8491,114,2660,11424,11498,9313,1288,10580,10499,6428,10112,5336,8787,8881,7569,3796,4429,10810,8937,1401,4728,7780,6447,12004,12128,11788,7547,6217,10734,8014,9011,8588,9235,6771,1551,11204,6888,9616,10089,4025,5451,6427,840,11861,10261,7093,1702,2153,2756,1944,5187,6841,1462,740,6762,3461,3643,10913,4402,11769,7038,2333,11554,11573,11116,7183,4538,12287,5282,11385,9230,708,10713,7386,10828,10680,2709,2089,3091,5043,11868,5831,7972,4815,1503,4940,3443,9193,6501,3676,10107,10308,10829,3551,317,7534,4185,1559,3696,11550,10490,3286,5237,8601,12195,10976,5929,2137,7408,3373,7056,10568,7673,9846,8378,6581,343,724,4409,10843,491,6721,404,771,9436,10316,2955,673,8001,8167,7818,9642,8951,8073,356,10219,1806,9964,3423,5351,8276,6868,4463,3731,1709,1646,10136,11714,7222,268,7831,9821,237,4861,2984,10724,7968,4601,96,2611,11231,7785,2078,11872,2851,6123,1469,10547,7897,8781,7702,3911,7997,6279,2543,8426,2199,4278,10840,6058,432,7110,3882,9173,2840,5143,10282,11234,8445,7674,7366,6184,2305,10139,2682,11685,9588,7876,617,757,11896,7689,1789,10752,2165,9557,3304,7358,10612,9464,10975,10597,507,7277,10908,346,7775,11785,7962,2316,2895,10086,10987,6626,12012,169,5568,9289,1255,6465,2827,623,9176,6015,7574,11469,9741,3819,9773,302,9926,11590,12137,4670,8423,5050,300,5456,11761,3025,11997,7625,6794,2873,5031,11354,9160,11160,10591,4248,76,2857,9404,6965,8031,8866,7984,814,9135,11011,11392,8857,4504,3304,5456,416,7602,3384,9767,5873,3611,9336,4282,276,9351,8978,4333,10913,1106,7948,9722,1941,2005,6279,4484,10563,10022,9565,3447,7454,5481,5404,4565,5382,9501,7135,6562,229,6709,6721,3730,11268,8432,11021,904,4673,3188,10728,1995,9412,6050,2190,5162,8794,2260,1579,1909,8497,11812,4816,6890,980,6036,3328,4817,6173,2573,7828,6134,6407,8708,403,6383,6095,6281,229,2464,316,854,9733];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.ntt_sm2[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "My name is Simon";
        sig.salt =
            "\x16\x1a\x97\xe0\xf4\xc6\x89\x2a\xea\x94\x2a\x85\xf1\x01\xad\x3a\x6b\x54\xe0\x5c\xa4\x30\xfa\x33\x8c\x46\xd5\xc4\x50\x04\xa5\x7b\x73\x4f\x55\x14\x41\x5c\x71\x93";
        address recovered_pk_1;
        recovered_pk_1 = falconrec.recover(message, sig);
        assertEq(pk_1, recovered_pk_1);
    }

    function testVector2() public {
        // public key
        // forgefmt: disable-next-line
        address pk_2 = address(589959844205978517058917870757624514131424632278);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(82), 212,12153,6,35,12125,11890,12222,230,196,169,12256,12115,12189,12113,53,73,103,12288,12133,72,147,12205,83,112,12240,421,11937,83,87,32,206,86,90,11982,12231,69,12195,12197,12177,158,12173,169,124,12140,12287,27,12133,12129,12279,12231,12019,279,12017,163,28,12275,12114,67,124,12189,12188,12192,22,12212,12097,66,12253,12129,12223,12280,12160,12186,12084,21,12237,86,257,12199,11922,59,59,12092,12239,12196,51,131,12132,154,12228,12210,12225,111,12050,12188,134,348,48,89,174,12245,134,169,12051,12192,300,59,276,12205,115,270,12000,64,12210,12029,55,12232,12191,12147,124,328,12209,12218,12288,148,41,210,41,268,93,12262,12082,12177,12246,33,85,12208,12073,66,12122,10,67,12211,99,12172,12237,12235,116,12166,12183,160,141,11981,12195,284,12069,157,12120,2,182,12089,125,105,184,41,12189,118,11993,78,57,288,12099,12106,12226,165,12010,71,21,12121,12239,62,12237,6,12244,11998,12181,11887,12205,12169,193,12119,12144,12252,12,138,182,167,218,12058,5,244,12235,197,101,12114,110,19,64,12056,136,12206,194,12119,12154,12206,368,12142,186,11978,256,213,5,12025,12275,30,12173,3,11965,279,11926,69,12139,12086,233,12226,12243,106,104,12246,12228,12026,254,12288,12127,47,61,23,12194,246,167,30,12276,12079,12036,12085,12063,12198,12101,12220,12158,315,12145,12275,12117,12025,51,11914,22,247,12016,31,177,12250,77,96,12231,87,12067,12044,12055,12090,23,12214,58,21,26,42,452,12139,170,45,12164,232,12085,442,36,12150,12089,12222,12129,12205,21,217,1,12202,12284,12235,91,77,12206,381,251,12215,14,322,167,12050,12239,12260,12251,19,276,12141,12105,221,133,49,12141,12037,249,12026,75,124,57,12183,31,173,12250,12235,12142,12258,12248,230,12228,16,12287,241,12069,29,187,138,189,77,12194,8,12,12223,12124,53,12230,132,12278,12100,12165,86,12273,12101,194,11810,80,12113,109,14,77,233,36,12180,12120,12277,6,86,259,12194,385,12227,509,11937,102,12116,12207,200,105,12189,107,12152,126,138,77,12217,43,12243,62,12277,12,54,12215,12266,158,101,104,277,237,12063,160,67,235,12162,12001,12183,15,12188,23,16,12187,12163,123,12206,174,97,23,26,35,12233,12090,11943,12229,11910,12031,158,12146,19,12286,12186,12209,12114,47,165,152,12031,31,270,12287,89,12243,12137,12274,65,12251,12217,12101,12031,12234,12172,11968,11733,155,11863,77,30,182,12288,12179,12280,11949,17,107,11972,325,12103,94,12077,149,103,291,12241,12148,12189,28,30,12074,12119,33,129,207,283,12275,144,4,206,12111,12170,12072,12248,12120,12136,12114,12209,262,12250,355,12171,12116];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(129), 248,12184,68,84,232,12220,279,15,12208,103,236,105,272,12266,110,328,12169,12163,12119,230,11,12277,9,106,189,124,161,12153,12011,11926,279,11976,406,73,283,54,5,12005,57,12157,302,11996,12285,50,170,227,12247,12275,235,12112,12226,225,111,11952,11886,12221,12197,218,4,68,190,12254,66,120,151,12151,216,16,217,12016,12138,12028,12142,60,328,12205,41,12164,12098,12215,12263,280,12253,155,12250,53,12069,131,12270,12249,36,12282,165,346,61,12164,102,12153,392,12213,162,74,12146,12165,12014,12227,12024,83,356,76,12226,240,12217,12261,203,121,12182,11944,12212,12225,12110,137,390,12138,74,12283,95,22,12134,12246,109,12214,12279,12113,20,12177,40,229,12119,12277,124,12142,12074,38,242,148,21,93,120,12283,60,12222,220,448,12286,103,12071,12272,12168,12240,48,12259,12,12,12094,12174,123,12036,85,60,197,134,49,401,12101,12281,277,12120,60,12218,136,10,12186,249,142,216,12286,12191,12004,12281,12213,31,37,362,266,232,119,135,172,12258,12135,12031,12185,140,12027,12176,12267,12253,443,12036,12154,330,11935,12116,11958,12234,57,11993,12221,12122,75,12194,12179,249,63,45,418,44,12123,11970,12189,12270,244,12092,12042,32,12207,172,12187,12214,18,12281,280,36,12107,49,80,12231,12162,12284,12288,191,44,115,12247,12040,12180,12195,114,192,63,17,12273,12125,12279,12233,79,98,12043,12155,12223,236,12102,60,12204,12259,11995,197,248,86,113,12056,12273,12246,422,95,12172,84,12066,12059,172,209,222,4,12286,72,12210,324,12172,10,12270,12160,135,117,12134,12231,93,171,12155,99,12271,12065,12226,330,137,11991,11928,52,12159,11960,12107,12201,78,47,182,264,187,136,12164,145,18,285,57,17,12192,12261,12179,19,12231,12010,12207,12230,12072,7,12099,136,209,364,12259,346,369,12206,193,12126,12255,175,132,110,117,12154,46,147,12272,287,27,88,12197,150,83,12159,293,242,12138,11995,12215,50,108,12092,12123,45,12252,47,12001,57,82,60,146,12166,12037,109,119,12202,12207,126,12186,277,12257,222,4,12162,12193,62,24,172,291,281,12203,12212,125,12159,61,148,281,12254,50,112,79,203,12240,88,12129,24,12279,137,59,12099,12172,298,131,12171,57,12023,12146,12187,12155,12,296,12193,12233,66,11966,12191,265,12269,172,12218,12250,106,109,12187,53,12082,232,12200,12281,30,12079,97,12050,12256,12193,134,93,61,59,311,12254,12219,12195,12244,12275,211,12066,98,12105,12201,12266,12280,240,193,12259,12134,20,159,69,12041,25,138,130,12251,0,12103,12094,12245,12235,154,81,23,87,208,224,30,221,23,12074,249,277,12194,121,12230,12253];

        ZKNOX_falconrec.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(4183), 5175,7425,5711,10943,2987,12200,1828,2244,4442,10733,1153,10427,3616,2764,5170,10489,9933,9941,2183,7168,8265,9797,8010,5990,9185,1395,2003,749,1370,1849,1229,7426,6795,891,12031,2764,4339,1173,5751,9196,10331,9486,922,10231,7934,9070,6404,220,8111,5464,10002,1614,3619,12048,8849,4445,7517,6640,10368,3470,10878,4553,11642,10702,9055,1270,3854,869,11158,100,9537,11907,4924,11487,5192,2408,1365,851,11282,222,10328,5881,9099,1503,8913,6762,12228,10245,5421,7540,2242,2422,9114,9025,10257,3765,6192,6775,6753,510,5164,5424,229,8617,3797,2642,5593,1477,2622,2806,8620,9722,2585,4973,3847,11298,10213,10278,5441,10840,6259,11700,6605,7063,681,4373,7393,12048,2897,11999,8374,10481,2849,1924,3828,3010,620,5753,3798,10035,9841,11851,7392,11564,2719,11480,11799,8963,2113,8434,9745,10447,8643,212,12012,5007,10522,1477,6767,142,660,5268,4339,9110,9927,10469,2583,3453,11351,3159,9962,12227,622,6183,10306,5976,11956,2989,1274,4862,285,178,9360,11351,6911,5971,6137,1533,9578,10842,7240,10559,11888,11322,3035,1136,10436,2577,1178,3334,9801,1871,2351,6190,5748,2387,9125,4988,2147,9720,10544,6730,7634,2001,4622,9380,9977,7282,5965,11359,5473,6634,581,9219,11458,9686,10651,6291,5508,6621,11362,10689,2917,12263,9091,4938,558,4423,7481,8609,7180,2763,10641,11235,9158,3060,4643,7585,2284,8452,852,8797,5708,7258,6143,8240,11713,7268,7600,6460,9028,6653,1468,6268,322,10983,10582,797,10107,11232,999,1868,254,8348,9737,4952,12097,2285,715,4183,6240,5230,620,10443,2878,2377,2111,1611,9846,5360,11988,10713,7575,4948,4873,11730,8740,773,5805,2025,11474,3399,1454,8281,4381,1785,11350,6114,8200,7175,6399,10799,1639,4773,7819,10635,10178,11836,1553,23,1010,6140,6289,4045,4997,9690,1083,9700,1377,5434,10730,2521,6814,8078,7142,3666,6316,4700,5605,11785,3541,4088,7021,8766,6672,5437,352,203,11928,3716,2615,10869,2,9620,1594,11954,3623,1336,4949,3636,7860,3825,5644,5705,7031,8244,9003,545,3345,2376,8440,295,4780,5161,10331,6957,9753,3690,2770,9313,4602,5515,1624,12074,8584,9146,3380,10989,3622,8737,4745,1532,12071,12194,2044,6821,6994,6903,11219,10273,2713,9065,4648,10803,1871,11553,2750,11550,7326,3695,6179,5606,10553,8487,11555,9478,5716,2110,1687,8447,370,10374,5621,8764,5225,1625,11280,11290,10417,10301,8324,2781,11868,5543,8820,10166,9066,11982,3479,725,10920,1194,8098,2292,9566,6661,71,2961,8240,80,5231,9014,5193,4456,8694,1733,7901,6508,227,116,9474,11475,4676,11865,9722,2931,4958,6385,2411,6949,6882,8750,10707,4833,1956,19,2732,8310,653,6529,8958,10415,10100,12202,1950,4065,1006,3060,10922,10766,5225,10976,534,568,8954,2784,3140,7846,11189,6282,4158,2187,3486,10848,11295,9199,9604,9005,8231,7681,7041];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.ntt_sm2[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "My name is Nicolas";
        sig.salt =
            "\x16\x1a\x97\xe0\xf4\xc6\x89\x2a\xea\x94\x2a\x85\xf1\x01\xad\x3a\x6b\x54\xe0\x5c\xa4\x30\xfa\x33\x8c\x46\xd5\xc4\x50\x04\xa5\x7b\x73\x4f\x55\x14\x41\x5c\x71\x93";
        address recovered_pk_2;
        recovered_pk_2 = falconrec.recover(message, sig);
        assertEq(pk_2, recovered_pk_2);
    }

    function testVector3() public {
        // public key
        // forgefmt: disable-next-line
        address pk_3 = address(589959844205978517058917870757624514131424632278);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(12283), 12069,93,238,12145,12144,12085,12225,12229,12094,45,12217,230,12149,12236,11828,73,12039,208,12275,119,12112,134,21,12278,208,12250,80,57,344,126,55,11998,46,12,12137,11898,12119,64,12142,37,12285,184,12051,12152,110,46,11875,109,12115,12152,12110,12137,12118,366,12017,384,72,176,12119,12281,7,205,12195,12131,11981,157,30,338,253,12180,12174,54,282,12181,237,75,12056,149,12018,410,12190,12153,195,12187,12144,12222,11974,12147,12257,109,53,116,352,12218,290,12020,362,12277,12204,147,10,12116,12095,155,12158,12219,12233,12245,1,127,12183,87,123,11835,75,227,196,12231,176,12007,135,75,12196,118,11995,12237,152,12128,12075,11862,106,102,19,12215,12171,12102,12278,12085,33,21,12177,63,12065,2,11992,12185,12273,12119,12269,46,12234,12233,12218,12060,12070,125,12196,12103,12196,12186,232,12087,12187,12138,11992,90,185,1,53,11942,154,12107,12212,33,56,12029,12213,12060,12005,14,12214,234,12212,160,12229,12185,44,12229,0,12177,12194,54,12197,12201,28,30,96,12211,12202,71,12277,11925,85,61,11887,40,79,12116,193,12042,12234,12139,12246,229,118,12133,11977,149,12267,12273,150,11977,12286,12034,12126,78,37,12228,12082,12217,12178,12082,12061,12218,16,12138,156,12124,35,12143,12187,164,12145,11879,290,55,12144,23,158,12187,12271,12001,338,12220,205,12135,35,12281,12224,92,114,12284,12218,146,49,12283,12235,12130,69,12026,18,21,12197,12190,12,12194,42,12,9,12022,12068,12193,12193,132,12146,12135,12087,12239,55,153,12263,12233,129,7,145,12128,19,12129,5,12237,12058,122,113,12068,48,12237,12283,6,72,65,12274,23,40,70,12167,12188,326,12232,12223,12247,11983,12051,193,131,32,42,12269,183,61,122,181,117,199,12127,12127,11883,12257,181,12166,12267,151,157,12100,12167,12068,82,336,47,12276,12045,114,12122,12204,12007,207,38,12128,317,12286,134,12241,211,12178,12115,12220,17,164,11986,37,12092,110,12234,12276,38,129,12031,12172,12224,12258,45,226,12266,80,12156,12143,208,223,12236,12215,11995,12150,83,68,12017,12183,12264,12214,55,12125,110,20,12079,12081,23,172,150,12136,12170,237,12046,12276,12283,12264,12096,12268,254,12110,178,12284,18,225,12101,12125,230,115,12106,12120,12084,224,12278,12171,18,256,11938,12119,228,122,44,12236,135,12229,12248,238,199,103,12190,69,63,12243,12153,12148,252,197,178,12170,12057,12234,18,12286,12222,11946,12125,289,12244,12269,144,12243,12160,139,12268,12179,109,12068,54,12084,12270,38,12058,188,9,225,360,12180,12066,163,12177,12092,12192,12140,11954,30,12231,117,216,12204,12194,12183,43,12223,309,12237,337,12256,12273,117,12195,165,33,12100,12108,67];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(82), 403,239,246,210,12205,12169,15,11910,11912,12177,12053,162,304,12262,11814,12080,12215,12186,21,12278,140,105,12063,12081,292,12246,69,0,36,12220,12157,4,12244,12181,12201,12077,12285,12203,15,6,11897,288,45,12164,139,12277,181,26,12105,12087,12064,135,179,12248,12172,12244,12036,12148,148,12217,31,32,65,341,191,54,11888,12181,12184,12127,250,150,7,53,130,11972,256,82,118,11910,263,76,198,12247,12252,12186,12084,12204,12265,12260,12259,30,11890,40,12065,11934,38,12246,12215,12040,217,41,0,355,179,12210,73,103,189,328,71,12147,12222,12271,364,12054,257,60,149,199,72,12024,12154,373,11758,23,12206,68,12261,433,25,12163,12123,12235,12178,25,200,12087,83,11985,12228,49,12046,11909,12153,12223,55,363,138,20,41,233,222,12124,11893,12180,12138,12132,24,185,12254,203,216,12203,12107,12184,12191,226,47,68,12070,12281,342,12147,11969,108,44,94,12268,106,12215,12245,11968,11978,47,101,12245,12259,12142,38,80,167,12136,12128,12216,91,245,12275,12114,12269,12192,12215,67,278,374,12209,37,67,12150,34,12022,12151,247,12228,12172,77,12225,12184,12187,11966,12189,11923,67,27,12143,16,226,12264,12194,204,12019,66,91,12160,96,49,12266,216,169,12273,12237,89,60,12263,123,130,292,36,12288,48,98,371,124,123,12063,133,308,78,168,12179,12079,9,52,12271,12070,59,12186,231,12129,12112,311,149,12137,147,210,316,12129,12154,60,120,12194,396,12226,273,12210,44,12034,135,12229,12108,12272,11916,12217,86,12198,181,44,12042,70,57,12267,12192,12174,248,12175,11879,142,128,36,12123,58,12193,12267,19,254,142,78,151,178,167,50,341,364,117,12250,135,12226,170,28,12236,30,84,12132,120,87,102,98,12,12280,12242,12133,12152,12159,36,12111,12279,45,35,12218,67,12224,46,12145,12134,12222,321,11969,104,12253,11965,12099,12284,12224,212,12214,91,12206,12183,114,12185,130,12286,143,12111,12183,221,11842,12217,12010,12014,12132,12239,129,213,207,151,359,12256,12260,12129,12231,12253,12285,12092,12005,30,8,151,12281,12184,140,140,12274,12199,29,12021,189,10,145,12009,96,12258,59,34,12185,177,12213,28,78,75,12126,12175,12190,41,12150,200,65,286,11891,170,12213,33,24,12163,245,384,167,12099,64,111,65,12062,293,349,217,12207,12153,0,12270,11756,58,12073,39,12213,81,162,102,12176,14,94,12147,12199,1,12073,12240,12223,39,19,12173,11908,81,12011,12130,12091,12087,33,12251,12237,387,12191,259,74,12198,21,12198,273,12181,12137,244,117,12172,59,12232,31,163,84,12124,25,250,59,12161,12210,59,12280,12097,12177,12247,63,12196,12182,12043];

        ZKNOX_falconrec.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(1086), 4741,5782,11005,6215,11175,2405,11033,124,8438,2677,10250,85,1254,9378,10807,10926,10113,12040,3029,4866,8931,10948,8824,9279,9252,7329,10315,5998,271,7500,804,5695,8910,830,11015,5200,4165,8687,8530,2056,7399,5575,3540,6404,6888,8933,839,3108,11379,3501,5995,362,5749,2911,11274,7431,9579,7406,4264,10067,9216,6877,5694,6920,8309,5988,10238,14,789,6491,704,6977,8704,310,5624,4140,8869,7057,6472,3503,11251,4645,782,4432,9558,12127,10664,1618,4846,153,8350,12145,3269,5436,9762,3310,11077,4116,11422,3951,6954,8385,7153,12138,11937,5507,8065,5615,3185,10152,9526,3395,2491,5311,4162,8355,10393,1994,12247,2840,11854,7747,5677,6631,5166,7288,9153,5757,5316,6509,10743,6681,8043,11717,4467,2379,5063,6832,6131,5688,1810,7533,9981,8831,4181,1421,10193,2118,7860,7220,9408,11278,11261,8098,9507,3082,7497,8928,2038,7991,6782,1082,293,4722,10083,3697,5896,3760,12093,1896,800,5691,3313,5843,315,8097,9095,11527,3058,2095,7911,1019,10320,9124,4054,2435,4650,5813,3909,7156,5878,4609,4389,11193,10584,11382,321,10023,9107,3475,3211,4342,11960,4902,3047,7425,3332,11090,12066,1573,5767,9699,1062,7510,3603,1222,620,367,3851,9274,1702,3181,1987,10022,11998,1564,128,12174,11919,2597,7270,9893,11581,5410,7226,5416,1694,7573,11450,10502,5803,6774,8334,7361,11639,6724,5332,6680,6020,7438,2421,11014,6654,5091,8435,4229,4445,8075,10516,1502,7489,10443,11260,429,10537,1432,4030,4256,7514,2488,1696,1673,11541,10058,6569,684,7723,7785,6616,8689,7497,1780,9429,3275,762,7892,347,11021,3581,9631,11105,6912,8890,11400,8061,6491,782,6027,5897,2324,5503,7660,11445,11086,10285,4167,5517,2738,6991,2037,4227,10453,7071,3770,8015,11532,12188,5009,10668,7093,5308,524,7235,10130,2455,7912,7361,1666,2440,10448,10600,5525,5047,8077,2945,6790,10192,4715,7892,1966,2615,3503,8703,5906,1756,5593,655,5781,4023,12198,3381,1431,5373,6619,5635,1687,6568,1114,10874,7699,2810,9121,8516,4158,4274,9207,1414,9665,332,1738,4585,8824,10502,1239,9453,12222,1941,9912,11775,7570,1491,3445,7754,4856,11936,5536,532,10517,4083,7049,9393,6960,6061,6739,9262,1346,8864,4797,12171,12255,10961,4883,10554,10108,4463,10284,10008,1931,8563,1742,4650,8552,4295,4795,10733,1596,7686,2894,3431,2451,5059,6530,9966,6626,7257,7353,2873,6702,1353,10305,2130,10057,7467,887,9389,10062,2295,11190,3617,8936,9730,11727,4536,9246,9663,5951,4534,7963,9751,9332,10468,829,11405,1809,1732,3963,5890,1612,5648,9177,1239,346,10710,1593,11290,4061,1483,8869,1484,2348,9058,3734,9846,2669,9045,8492,12047,3793,11936,6319,2624,7783,2436,9414,6732,393,4576,7468,7977,1503,2213,3901,7322,8579,6496,1130,4625,3684,6410,2038,74,7512,4972,2947,9566,3670,2381,2932,8821,5501,5378];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.ntt_sm2[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "We are ZKNox";
        sig.salt =
            "\x16\x1a\x97\xe0\xf4\xc6\x89\x2a\xea\x94\x2a\x85\xf1\x01\xad\x3a\x6b\x54\xe0\x5c\xa4\x30\xfa\x33\x8c\x46\xd5\xc4\x50\x04\xa5\x7b\x73\x4f\x55\x14\x41\x5c\x71\x93";
        address recovered_pk_3;
        recovered_pk_3 = falconrec.recover(message, sig);
        assertEq(pk_3, recovered_pk_3);
    }
}
